# JSON Quiz Builder

JSON Quiz Builder is a production-ready web app that lets admins validate and publish quizzes from JSON definitions, then provides a polished quiz-taking experience with scoring, timers, and review mode.

## Features

- Paste or upload quiz JSON files.
- Schema validation with helpful errors and warnings.
- Live preview of quiz metadata and question layouts.
- Publish quizzes with owner-based access control and generate shareable links.
- Full quiz runner with timer, navigation, results review, and required/optional question rules.
- Authenticated backend with RBAC, auditing, and analytics-ready attempt data.
- Dark mode toggle, responsive layout, and accessible controls.

## Tech Stack

- React + TypeScript + Vite
- Express + PostgreSQL backend
- Zod for validation
- Vitest for unit tests
- Playwright for E2E testing

## Getting Started

```bash
npm install
npm run db:migrate
npm run db:seed
npm run server
npm run dev
```

The app will be available at `http://localhost:5173`.

To run both frontend and backend together:

```bash
npm run dev:full
```

### Environment Variables

Create a `.env` file for the backend:

```bash
DATABASE_URL=postgres://postgres:postgres@localhost:5432/json_quiz_builder
SESSION_SECRET=replace-me
```

Seeded accounts:
- `owner@example.com` / `password123`
- `participant@example.com` / `password123`

## JSON Format

```json
{
  "id": "product-quiz",
  "title": "Product Basics",
  "description": "A quick quiz about product strategy.",
  "timeLimitSeconds": 120,
  "passingScore": 70,
  "shuffleQuestions": false,
  "shuffleOptions": false,
  "showQuestionList": true,
  "allowSkip": true,
  "enforceRequiredBeforeSubmit": true,
  "visibility": "private",
  "questions": [
    {
      "id": "q1",
      "type": "multiple_choice_single",
      "prompt": "Which metric best describes product retention?",
      "required": true,
      "points": 2,
      "options": ["DAU/MAU", "CTR", "NPS", "CAC"],
      "correctAnswer": "DAU/MAU",
      "explanation": "DAU/MAU is a common retention proxy."
    },
    {
      "id": "q2",
      "type": "true_false",
      "prompt": "Net Promoter Score is a loyalty metric.",
      "required": true,
      "points": 1,
      "correctAnswer": true
    },
    {
      "id": "q3",
      "type": "multiple_choice_multi",
      "prompt": "Pick two qualitative research methods.",
      "required": false,
      "points": 2,
      "options": ["Surveys", "Interviews", "Usability tests", "A/B tests"],
      "correctAnswers": ["Interviews", "Usability tests"]
    },
    {
      "id": "q4",
      "type": "short_text",
      "prompt": "Name a product discovery framework.",
      "required": false,
      "points": 1,
      "acceptedAnswers": ["double diamond", "opportunity solution tree"]
    }
  ]
}
```

## Tests

```bash
npm run test
npm run e2e
```

## Deployment

```bash
npm run build
npm run preview
```

For static hosting, deploy the `dist` folder generated by `npm run build`.

## Backend Notes

- Sessions are stored in PostgreSQL via `connect-pg-simple` and secured with HTTP-only cookies.
- CSRF protection is enabled; the frontend fetches `/api/auth/csrf` before state-changing requests.
- Audit logs capture signups, logins, quiz lifecycle actions, and attempts for compliance tracking.

## API Contract

### Auth
- `POST /api/auth/signup`
- `POST /api/auth/login`
- `POST /api/auth/logout`
- `GET /api/auth/me`

### Quizzes (owner)
- `POST /api/quizzes` (create draft)
- `POST /api/quizzes/import` (JSON import)
- `GET /api/quizzes/mine`
- `GET /api/quizzes/:id`
- `PUT /api/quizzes/:id`
- `POST /api/quizzes/:id/publish`
- `DELETE /api/quizzes/:id`
- `GET /api/quizzes/:id/attempts`

### Attempts (participant)
- `POST /api/quizzes/:id/attempts/start`
- `POST /api/attempts/:attemptId/answer`
- `POST /api/attempts/:attemptId/submit`
- `GET /api/attempts/mine`
- `GET /api/attempts/:attemptId`

### Error format
Errors are returned as:

```json
{
  "error": {
    "message": "Validation failed.",
    "code": "validation_error",
    "details": [{ "message": "Prompt is required.", "field": "questions.0.prompt" }]
  }
}
```

## Data Model

Core tables (see `server/migrations/001_init.sql`):
- `users` (auth + roles)
- `sessions` (HTTP-only sessions)
- `quizzes`, `questions`, `options`
- `attempts`, `answers`
- `audit_logs`

## Security Tradeoffs

- Sessions are stored in Postgres for durability. For high scale, move to Redis.
- CSRF protection is enabled for state-changing requests via the `/api/auth/csrf` token.
- Rate limiting is applied on auth endpoints to reduce brute-force attempts.
